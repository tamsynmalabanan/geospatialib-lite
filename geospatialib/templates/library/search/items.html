{% load util_tags %}

{% for content in contents %}
    <li 
        class="list-group-item d-flex border-0 p-0 pb-3 w-100"
        {% if forloop.last and page_obj.has_next  %}
            hx-get="{% url 'hx_library:search' %}?page={{page_obj.number|add:1}}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{key}}={{value}}{% endif %}{% endfor %}"
            hx-trigger="intersect once"
            hx-swap='afterend'
            hx-target='this'
            hx-indicator=".htmx-indicator-{{page_obj.number}}"
        {% endif %}
    >   
        <div class='d-flex flex-column gap-2 me-2'>
            <input 
                class="form-check-input me-1" 
                tabindex="-1"
                type="checkbox" 
                {% if content.type == 'dataset' %}
                    onclick="toggleLibraryLayer(event, '#geospatialibMap')"
                    data-layer-bbox="{{content.bbox.extent}}"
                    data-layer-pk="{{content.dataset__id}}"
                    data-layer-url="{{content.dataset__url__url}}"
                    data-layer-format="{{content.dataset__format}}"
                    data-layer-name="{{content.dataset__name}}"
                    {% if content.dataset__extra_data %}
                        {% var content.dataset__extra_data|json_loads as extra_data %}
                        data-layer-styles="{{extra_data.layer.styles|json_dumps}}"
                    {% endif %}
                {% endif %}
            >
        </div>
        <div class='d-flex flex-column flex-grow-1 me-3 w-75'>
            <label class="form-check-label fw-semibold d-flex justify-content-between">
                <span>
                    {{content.label}}
                </span>
            </label>
            <div class="d-flex w-100">
                <div class='fw-lighter mt-1 small text-wrap w-100'>
                    {% if content.headline %}
                        {{content.headline|safe}}
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="dropdown">
            <button class="p-0 border-0 bg-transparent text-muted" tabindex="-1" type="button" data-bs-toggle="dropdown" aria-expanded="false" onclick="populateLayerDropdownMenu(this, '{{content.bbox.extent}}', '#geospatialibMap')">
                <i class="bi bi-three-dots"></i>
            </button>
            <ul class="dropdown-menu"></ul>
        </div>
    </li>
    {% if forloop.last and page_obj.has_next %}
        <div class="d-flex justify-content-center gap-3">
            {% for i in '123' %}
                <div class="spinner-grow spinner-grow-sm text-primary my-3 htmx-indicator htmx-indicator-{{page_obj.number}}" role="status"></div>
            {% endfor %}
        </div>
    {% endif %}
{% endfor %}
