{% load util_tags %}

{% for content in contents %}
    <li 
        class="list-group-item d-flex border-0 p-0 pb-3 w-100 user-select-none gap-3"
        {% if forloop.last and page_obj.has_next  %}
            hx-get="{% url 'hx_library:search' %}?page={{page_obj.number|add:1}}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{key}}={{value}}{% endif %}{% endfor %}"
            hx-trigger="intersect once"
            hx-swap='afterend'
            hx-target='this'
            hx-indicator=".htmx-indicator-{{page_obj.number}}"
        {% endif %}
    >   
        <input 
            class="form-check-input" 
            tabindex="-1"
            type="checkbox" 
            {% if content.type == 'dataset' %}
                onclick="toggleLayer(event, {mapSelector:'#geospatialibMap'})"
                data-layer-bbox="{{content.bbox.extent}}"
                data-layer-label="{{content.label}}"
                data-layer-url="{{content.dataset__url__url}}"
                data-layer-format="{{content.dataset__format}}"
                data-layer-name="{{content.dataset__name}}"
                {% if content.dataset__extra_data %}
                    {% var content.dataset__extra_data|json_loads as extra_data %}
                    data-layer-styles="{{extra_data.layer.styles|json_dumps}}"
                {% endif %}
            {% endif %}
        >
        <div class='d-flex flex-column flex-grow-1 w-75'>
            <label class="form-check-label fw-semibold d-flex justify-content-between gap-3">
                <span>
                    {{content.label}}
                </span>
            </label>
            <div class="d-flex flex-column gap-1 w-100">
                <div class='fw-lighter mt-1 small text-wrap w-100 text-justify'>
                    {% if content.headline %}
                        {{content.headline|safe}}
                    {% endif %}
                </div>
                <div>
                    <a class='badge rounded-pill bg-primary-subtle text-reset text-decoration-none font-monospace fw-normal' href="{{content.dataset__url__url}}" target="_blank" rel="noopener noreferrer">
                        {{content.dataset__url__url|domain}}
                    </a>
                    {% comment %} <span class='badge rounded-pill bg-primary-subtle text-reset text-decoration-none font-monospace fw-normal'>
                        {{content.dataset__format}}
                    </span>
                    <span class='badge rounded-pill bg-primary-subtle text-reset text-decoration-none font-monospace fw-normal'>
                        {{content.dataset__name}}
                    </span> {% endcomment %}
                </div>
            </div>
        </div>
        <div class="dropdown">
            <button class="p-0 border-0 bg-transparent text-muted" tabindex="-1" type="button" data-bs-toggle="dropdown" aria-expanded="false" onclick="populateLayerDropdownMenu(this, {mapSelector:'#geospatialibMap', bboxCoords:'{{content.bbox.extent}}', layerGroup:'library'})">
                <i class="bi bi-three-dots"></i>
            </button>
            <ul class="dropdown-menu fs-12"></ul>
        </div>                
    </li>
    {% if forloop.last and page_obj.has_next %}
        <div class="d-flex justify-content-center gap-3">
            {% for i in '123' %}
                <div class="spinner-grow spinner-grow-sm text-primary my-3 htmx-indicator htmx-indicator-{{page_obj.number}}" role="status"></div>
            {% endfor %}
        </div>
    {% endif %}
{% endfor %}
