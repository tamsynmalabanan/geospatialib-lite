{% load util_tags %}

{% for content in page_obj.object_list %}
    <li 
        class="list-group-item d-flex border-0 p-0 pb-3 w-100 user-select-none gap-3"
        {% if forloop.last and page_obj.has_next  %}
            hx-get="{% url 'hx_library:search' %}{% querystring page=page_obj.number|add:1 %}"
            hx-trigger="intersect once"
            hx-swap='afterend'
            hx-target='this'
            hx-indicator=".htmx-indicator-{{page_obj.number}}"
        {% endif %}
    >   
        <input 
            class="form-check-input" 
            tabindex="-1"
            type="checkbox" 
            {% if content.type == 'dataset' %}
                onclick="toggleLayer(event, {mapSelector:'#geospatialibMap'})"
                data-layer-bbox="{{content.bbox.extent}}"
                data-layer-label="{{content.label}}"
                data-layer-url="{{content.dataset__url__url}}"
                data-layer-format="{{content.dataset__format}}"
                data-layer-name="{{content.dataset__name}}"
                data-layer-style="{{content.dataset__default_style}}"
                {% if content.dataset__default_legend__url %}
                    data-layer-legend="{{content.dataset__default_legend__url}}"
                {% endif %}
            {% endif %}
        >
        <div class='d-flex flex-column flex-grow-1 w-75'>
            <label class="form-check-label fw-semibold d-flex justify-content-between gap-2">
                <span class='me-5'>{{content.label}}</span>
                <div class="dropdown ms-auto">
                    <button class="p-0 border-0 bg-transparent" tabindex="-1" type="button" data-bs-toggle="dropdown" aria-expanded="false" onclick="populateLayerDropdownMenu(this, {mapSelector:'#geospatialibMap', bboxCoords:'{{content.bbox.extent}}', layerGroup:'library'})">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <ul class="dropdown-menu fs-12"></ul>
                </div>       
                <button class="bg-transparent border-0 p-0 d-flex align-content-start" type="button" data-bs-toggle="collapse" data-bs-target="#searchResult_{{content.pk}}" aria-expanded="false" aria-controls="searchResult_{{content.pk}}">
                    <span class='dropdown-toggle'></span>
                </button>                 
            </label>
            <div class="collapse" id="searchResult_{{content.pk}}">
                <div class="d-flex flex-column gap-1 w-100">
                    {% comment %} <div class='fw-lighter mt-1 small text-wrap w-100 text-justify'>
                        {% if content.headline %}
                            {{content.headline|safe}}
                        {% endif %}
                    </div> {% endcomment %}
                    <div>
                        <a class='badge rounded-pill bg-primary-subtle text-reset text-decoration-none font-monospace fw-normal' href="{{content.dataset__url__url}}" target="_blank" rel="noopener noreferrer">
                            {{content.dataset__url__url|domain}}
                        </a>
                        <span class='badge rounded-pill bg-primary-subtle text-reset text-decoration-none font-monospace fw-normal'>
                            {{content.dataset__format}}
                        </span>
                        <span class='badge rounded-pill bg-primary-subtle text-reset text-decoration-none font-monospace fw-normal'>
                            {{content.dataset__name}}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </li>
    {% if forloop.last and page_obj.has_next %}
        <li class="htmx-indicator htmx-indicator-{{page_obj.number}}">
            <div class='d-flex justify-content-center gap-3'>
                {% for i in '123' %}
                    <div class="spinner-grow spinner-grow-sm text-primary my-3 " role="status"></div>
                {% endfor %}
            </div>
        </li>
    {% endif %}
{% endfor %}
