{% load util_tags %}

<div id='searchResultsFiltersContainer' hx-swap-oob='true' class='mb-3'>
    {% if page_obj.number %}
        {% with count=page_obj.paginator.count %}
            {% if count > 0 %}
                <div class='d-flex gap-3 flex-nowrap'>
                    <a 
                        class="text-reset text-decoration-none fs-6 d-flex flex-nowrap justify-content-between flex-grow-1" 
                        data-bs-toggle="collapse" 
                        href="#searchResultsFilters" 
                        role="button" 
                        aria-expanded="true"
                        aria-controls="searchResultsFilters"
                    >
                        <span>Results for "{{request.GET.query}}" ({{count}})</span>
                        <i class="bi bi-funnel ms-2"></i>
                    </a>
                    <button class='border-0 bg-transparent px-0 d-flex align-items-start' type='submit' name='bbox__bboverlaps' title='Seach map extent'><i class="bi bi-bounding-box-circles"></i></button>
                    <button class='border-0 bg-transparent px-0 d-flex align-items-start' type='submit' title='Clear all filters'><i class="bi bi-trash"></i></button>
                </div>
                <div class="collapse show" id="searchResultsFilters">
                    <div class="d-flex gap-2 mt-3">
                        {% for field, queryset in filters.items %}
                            {% for i in queryset %}
                                {% var i|get:field as label %}
                                {% if label %}
                                    {% if request.GET|get:field == label %}
                                        <button
                                            type='submit'
                                            name="{{field}}"
                                            value=""
                                            class="btn btn-sm btn-primary rounded-pill px-3"
                                        >{{label}} ({{i.count}})</button>
                                    {% else %}
                                        {% if i.count != count %}
                                            <button
                                                type='submit'
                                                name="{{field}}"
                                                value="{{label}}"
                                                class="btn btn-sm btn-outline-primary rounded-pill px-3"
                                            >{{label}} ({{i.count}})</button>
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
            {% else %}
            <div class="d-flex gap-3 flex-nowrap justify-content-between">
                <span class-'mb-3'>No results found for "{{request.GET.query}}"</span>
                <button class='border-0 bg-transparent px-0 d-flex align-items-start' type='submit' title='Clear all filters'><i class="bi bi-trash"></i></button>
            </div>
            {% endif %}
        {% endwith %}
    {% endif %}
</div>
